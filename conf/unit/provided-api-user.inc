dnl vim: set filetype=sysctl.conf.m4 syntax=sysctl.conf.m4:
;-------------------------------------------------------------------------------
;----        T H E   S E R V I C E   O F   T H E   A P I                    ----
;-------------------------------------------------------------------------------
%begin systemd-unit

# auto generated by wgtpkg-unit for {{:id}} version {{:version}} target {{:#target}} of {{:idaver}}

%systemd-unit system
%systemd-unit service UNIT_NAME_API_BASE({{name}})@

[Unit]
Description=Provides api {{name}} for user %i
X-AFM-API-TYPE={{value}}

Requires=afm-user-setup@%i.service
After=afm-user-setup@%i.service

Requires=UNIT_NAME_API_BASE({{name}})@%i.socket
After=UNIT_NAME_API_BASE({{name}})@%i.socket

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/bin/true

%end systemd-unit

;-------------------------------------------------------------------------------
;----        T H E   S O C K E T   O F   T H E   A P I                      ----
;-------------------------------------------------------------------------------

%begin systemd-unit

# auto generated by wgtpkg-unit for {{:id}} version {{:version}} target {{:#target}} of {{:idaver}}

%systemd-unit system
%systemd-unit socket UNIT_NAME_API_BASE({{name}})@
[Unit]
Description=Provides websocket api {{name}} for user %i
Requires=afm-user-setup@%i.service
After=afm-user-setup@%i.service
DefaultDependencies=no

[Socket]
SmackLabel=*
SmackLabelIPIn=System
SmackLabelIPOut=System
ListenStream=USER_API_PATH_WS/{{name}}
FileDescriptorName={{name}}
Service=UNIT_NAME_BASE@%i.service

%end systemd-unit
