dnl vim: set filetype=sysctl.conf.m4 syntax=sysctl.conf.m4:
;-------------------------------------------------------------------------------
;----        T H E   S E R V I C E   O F   T H E   A P I           (USER)   ----
;-------------------------------------------------------------------------------
%begin systemd-unit

# auto generated by redpesk framework for {{:id}} version {{:version}} target {{:#target}} of {{:idaver}}

%systemd-unit system
%systemd-unit service UNIT_NAME_API_BASE({{name}})@
%systemd-unit wanted-by afm-user-session@.target

[Unit]
Description=Provides api {{name}} for user %i
X-AFM-API-TYPE={{value}}

BindsTo=afm-user-setup@%i.service
After=afm-user-setup@%i.service

Requires=UNIT_NAME_API_BASE({{name}}).socket
After=UNIT_NAME_API_BASE({{name}}).socket

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/bin/true

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/bin/ln -sf FLOOR_PLATFORM_API_PATH_WS/{{name}} FLOOR_USER_API_PATH_WS/{{name}}

%end systemd-unit

;-------------------------------------------------------------------------------
;----        T H E   S E R V I C E   O F   T H E   A P I       (PLATFORM)   ----
;-------------------------------------------------------------------------------
%begin systemd-unit

# auto generated by redpesk framework for {{:id}} version {{:version}} target {{:#target}} of {{:idaver}}

%systemd-unit system
%systemd-unit service UNIT_NAME_API_BASE({{name}})
%systemd-unit wanted-by multi-user.target

[Unit]
Description=Provides api {{name}} for platform
X-AFM-API-TYPE={{value}}

Requires=afm-system-setup.service
After=afm-system-setup.service

Requires=UNIT_NAME_API_BASE({{name}}).socket
After=UNIT_NAME_API_BASE({{name}}).socket

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/bin/true

%end systemd-unit

;-------------------------------------------------------------------------------
;----        T H E   S O C K E T   O F   T H E   A P I         (PLATFORM)   ----
;-------------------------------------------------------------------------------

%begin systemd-unit

# auto generated by redpesk framework for {{:id}} version {{:version}} target {{:#target}} of {{:idaver}}

%systemd-unit system
%systemd-unit socket UNIT_NAME_API_BASE({{name}})
[Unit]
Description=Provides websocket api {{name}} for platform
Requires=afm-system-setup.service
After=afm-system-setup.service
DefaultDependencies=no

[Socket]
SmackLabel=*
SmackLabelIPIn=System
SmackLabelIPOut=System
SELinuxContextFromNet=true
ListenStream=FLOOR_PLATFORM_API_PATH_WS/{{name}}
FileDescriptorName={{name}}
Service=UNIT_NAME_BASE.service

%end systemd-unit
